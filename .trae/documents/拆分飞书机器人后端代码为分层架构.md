# 拆分飞书机器人后端代码为分层架构

## 目标
将当前单文件`feishu_bot.py`拆分为更标准的分层架构，包括：
- Controller层：处理HTTP请求
- Service层：实现业务逻辑
- 启动文件：初始化应用和数据库

## 拆分方案

### 1. 创建目录结构
```
AC-bot/
├── app.py                 # 启动文件
├── controllers/           # 控制器层
│   ├── task_controller.py  # 任务相关接口
│   ├── log_controller.py   # 日志相关接口
│   └── test_controller.py  # 测试相关接口
├── services/              # 服务层
│   ├── task_service.py     # 任务业务逻辑
│   ├── log_service.py      # 日志业务逻辑
│   ├── feishu_service.py   # 飞书消息发送
│   └── ai_service.py       # AI新闻和大模型调用
├── models/                # 数据模型层
│   └── db.py               # 数据库连接和初始化
└── scheduler/             # 调度器
    └── task_scheduler.py   # 任务调度逻辑
```

### 2. 代码拆分详情

#### 2.1 启动文件 (`app.py`)
- 初始化Flask应用
- 配置数据库
- 注册路由
- 启动应用和调度器

#### 2.2 控制器层
- `task_controller.py`：处理任务的增删改查、执行等HTTP请求
- `log_controller.py`：处理日志查询、清空等HTTP请求
- `test_controller.py`：处理Webhook测试、AI新闻获取等测试请求

#### 2.3 服务层
- `task_service.py`：实现任务的业务逻辑，包括任务的增删改查、执行等
- `log_service.py`：实现日志的业务逻辑，包括日志的查询、清空等
- `feishu_service.py`：实现飞书消息发送的逻辑
- `ai_service.py`：实现AI新闻获取和大模型调用的逻辑

#### 2.4 数据模型层
- `db.py`：实现数据库连接、初始化和基本操作

#### 2.5 调度器
- `task_scheduler.py`：实现任务的调度逻辑，包括任务的添加、移除和更新

### 3. 更新README.md
- 更新安装和运行说明
- 更新项目结构说明

### 4. 测试
- 确保拆分后的代码功能正常
- 确保所有API接口正常工作
- 确保任务调度正常运行

## 执行步骤

1. 创建所需目录结构
2. 实现数据模型层 (`db.py`)
3. 实现服务层各个模块
4. 实现调度器 (`task_scheduler.py`)
5. 实现控制器层各个模块
6. 实现启动文件 (`app.py`)
7. 更新README.md
8. 测试功能是否正常

## 预期效果
- 代码结构更清晰，便于维护和扩展
- 各层职责明确，符合软件设计原则
- 易于测试和调试
- 便于团队协作开发